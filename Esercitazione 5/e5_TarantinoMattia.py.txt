#!/usr/bin/env python
# coding: utf-8

# In[1]:


import numpy as np
import pandas as pd
import sys

epsilon = 1e-3


# In[2]:


file_name = "Esercitazione 5.xlsx"
df = pd.read_excel(file_name)

M = df.to_numpy()
S = M[:, -1]
M = np.delete(M, -1, axis = -1)

col, rows = np.shape(M)
w = 1


# In[84]:


def sol(A,x):

    x_col = x.reshape(-1, 1)

    sol = np.dot(A, x_col)
    sol = sol.flatten()

    return sol

def Gauss_Seidel(A, B, X):
    X_0 = np.zeros(len(X))
    err = float('inf')
    count = 0
    while(err > epsilon):
        X_0 = np.copy(X)
        count += 1
        for i in range( rows):
            Sum = B[i]

            for j in range(i):

                Sum -= A[i][j] * X[j]

            for k in range(i + 1, col):

                Sum -= A[i][k] * X_0[k]

            X[i] = (Sum)/A[i][i]
            err = np.max(np.abs(X[i] - X_0[i]))

        print(f"Eseguito giro {count}-esima volta")

    return X, count

def Gauss_Seidel_w(A, B, X, w):
    X_0 = np.zeros(len(X))
    err = float('inf')
    count = 0
    while(err > epsilon):
        X_0 = np.copy(X)
        count += 1
        for i in range( rows):

            Sum = 0

            for j in range(i):

                Sum += A[i][j] * X[j]

            for k in range(i + 1, col):

                Sum += A[i][k] * X_0[k]

            X[i] = X_0[i] + w * (((B[i] - Sum )/A[i][i]) - X_0[i])
            err = np.max(np.abs(X[i] - X_0[i]))

    return X, count


# In[86]:


Verifica = []
Somme = []
for i in range(len(M)):

    v = M[i]
    s = np.sum(np.abs(v)) - np.abs(M[i][i])
    Somme.append(s)
    if(np.abs(M[i][i]) > s):
        Verifica.append(True)
    else:
        Verifica.append(False)

mask = False
check = Verifica[mask] 
Somme = np.array(Somme)
print(Somme)
if not check:
    print("Matrice non rispetta la condizione sulla diagonale") #Verifico che la matrice rispetti le condizioni
    sys.exit()
x_i = np.ones(len(M[1]))
print(x_i)

X ,count_1 = Gauss_Seidel(M, S, x_i)
X = np.array(X)
Soluzione = sol(M,X)
for i in range(len(X)):

    print(f"X: {X[i]}")
print(f"Soluzione: {Soluzione}\n\nIterazioni: {count_1}")


# In[71]:


X_w = []
counter = []
for i in range(len(X)+1):


    x_i = np.ones(len(M[1]))
    w = 1 + i/10
    X_I, count = Gauss_Seidel_w(M, S, x_i, w)
    counter.append(count)
    X_w.append(X_I)

X_w = np.array(X_w)
#for i in range(len(X)+1):
#    print(f"Le soluzioni sono :{X_w[i]}\t\tCon w: {1 + i/10}\t\tIterando il processo: {counter[i]}")



# In[87]:


with open("e5_TarantinoMattia.txt" , "w") as fp:

    fp.write("----------------------------------------|Quesito Uno|----------------------------------------\n\n")
    fp.write(f"La condizione per far si che il sistema tenda al rilassamento è il seguente:\n\n\t\t|a_ii| >= sum(|a_ij|) con i != j\n\n")
    fp.write("---------------------------------------------------------------------------------------------\n\n")
    fp.write("----------------------------------------|Quesito Due|----------------------------------------\n\n")
    fp.write(f"Le soluzioni sono le seguenti:\n")
    for i in range(len(X)):
        if (X[i] > 0):

            fp.write(f" {X[i]}\n")
        else:
            fp.write(f"{X[i]}\n")
    fp.write(f"Effettuando {count_1} iterazioni")
    fp.write("\n---------------------------------------------------------------------------------------------\n\n")
    fp.write("----------------------------------------|Quesito Tre|----------------------------------------\n\n")
    for i in range(len(X)+1):
        fp.write(f"Le soluzioni sono :{X_w[i]}\t\tCon w: {1 + i/10}\t\tIterando il processo: {counter[i]}\n")
    fp.write(f"\nCome fosse normale aspettarsi le soluzioni convergono allo stesso valore, ma con una quantità di iterazioni differenti \ndovuta al parametro w che superiore a 1.1 ne ostacola la convergenza")





# In[ ]:




